server:
  port: 8080

spring:
  application:
    name: gateway-service
  main:
    allow-bean-definition-overriding: true
  
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
            maxAge: 3600
  
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

gateway:
  auth:
    enabled: ${GATEWAY_AUTH_ENABLED:true}
    skip-paths: /health,/actuator
  
  rate-limit:
    enabled: ${GATEWAY_RATE_LIMIT_ENABLED:true}
    # High rate limit for traffic generation and load testing
    default-requests-per-minute: ${GATEWAY_RATE_LIMIT_RPM:1000000}
    skip-paths: /health,/actuator
  
  telemetry:
    enabled: ${GATEWAY_TELEMETRY_ENABLED:true}
    analytics-url: ${ANALYTICS_SERVICE_URL:http://analytics-service:9000/api/v1/telemetry}
    batch-size: ${GATEWAY_TELEMETRY_BATCH_SIZE:100}
    batch-flush-interval-ms: 1000

resilience4j:
  circuitbreaker:
    instances:
      userServiceCircuitBreaker:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
      orderServiceCircuitBreaker:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
      paymentServiceCircuitBreaker:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5s
        failureRateThreshold: 50

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    com.sgp.gateway: INFO
    org.springframework.cloud.gateway: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

